{"version":3,"file":"cycconcept.service.js","sourceRoot":"","sources":["../../src/app/shared/cycconcept.service.ts"],"names":[],"mappings":"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","sourcesContent":["import { Injectable } from '@angular/core';\r\nimport {Http,Response} from '@angular/http';\r\nimport {URLSearchParams} from '@angular/http';\r\nimport {endpoints} from './endpoints';\r\nimport {Concept} from '../+concepts/concept.model';\r\nimport {Sentence} from '../+concepts/sentence.model';\r\nimport {Location} from '@angular/common';\r\ndeclare var Spinner:any;\r\n\r\n@Injectable()\r\nexport class CycconceptService {\r\n\r\n  private data: any[];\r\n  private concepts: Concept[] = [];\r\n  private errorMessage:string;\r\n  private selectedAudience: string;\r\n  private isComplete:boolean = false;\r\n\r\n  constructor(private _http: Http,private _location:Location) {\r\n  }\r\n\r\n  private extractSentence(concept: any,selectedSent:any[]): Sentence[] {\r\n    let ref:any = this;\r\n    var sentences = [];\r\n    concept.sentences.forEach(s => {\r\n     let sentSelected:boolean = ref.isSentencePreSelected(s,selectedSent);\r\n     if(sentSelected) {\r\n       concept.selected = true;\r\n     }\r\n      let se:Sentence = new Sentence(s.nl, s.cycl,sentSelected);\r\n      sentences.push(se);\r\n    })\r\n    return sentences;\r\n  }\r\n\r\n  public isCycQueryComplete():boolean {\r\n    return this.isComplete;\r\n  }\r\n\r\nprivate isSentencePreSelected(sentence:any, selectedSentences:any[]):boolean {\r\n  let selected:boolean = false;\r\n  selectedSentences.forEach(s =>{\r\n    if(s.name == sentence.nl && s.cycl == sentence.cycl){\r\n      selected =  s.sentenceSelected;\r\n      return;\r\n    }\r\n  })\r\n  return selected;\r\n  \r\n}\r\n\r\nprivate updateConceptsCache(availableConcepts:Concept[]){\r\n  let conceptsCache:any = {};\r\n  if(availableConcepts && availableConcepts.length) {\r\n    availableConcepts.forEach( c => {\r\n      let name:string = c.name;\r\n      conceptsCache[name]= true\r\n      });\r\n  }\r\n  return conceptsCache;\r\n}\r\n\r\n  public loadCycConcepts(targetAudience: string,availableConcepts:Concept[],selectedSentences:any[]) {\r\n    //TODO refactor spinner as a service.\r\n      this._location._subject.emit({ startAnimation: true });\r\n    this.concepts = [];\r\n    //TODO not the best way to keep track of existing concepts.\r\n    let cache:any = this.updateConceptsCache(availableConcepts);\r\n    var elem = document.getElementById('spinner');\r\n    var spinner = new Spinner({radius:60,width:20,length:80,lines:15,className:'loader',color:'wheat'}).spin(elem);\r\n    var ref = this;\r\n    let params: URLSearchParams = new URLSearchParams();\r\n    params.set('text', targetAudience);\r\n    this._http.get(endpoints.GET_CYC_CONCEPTS_DEMO, {\r\n      search: params\r\n    }).map(res => res.json())\r\n      .subscribe(data => {\r\n        if(data.statusCode !== 200) {\r\n          ref.errorMessage = 'Server encountered an error';\r\n          return;\r\n        }\r\n        let sessionId:string = data.sessionId;\r\n        data.concepts.forEach((c,index) => {\r\n          let isNew:boolean = false;\r\n          let isSelected:boolean = false;\r\n          if(availableConcepts && !cache[c.nl]) {\r\n            isNew = true;\r\n          }\r\n          let sent:Sentence[] = ref.extractSentence(c,selectedSentences);\r\n          let con:any = new Concept(c.nl, c.index,sent,sessionId,isNew,c.selected);\r\n          if(index == 0){\r\n            con.sentences.showSentences = true;\r\n          }\r\n          ref.concepts.push(con);\r\n        });\r\n        spinner.stop();\r\n        this._location._subject.emit({ stopAnimation: true });\r\n        this.isComplete = true;\r\n      });\r\n    return this.concepts;\r\n  }\r\n\r\n}\r\n"]}