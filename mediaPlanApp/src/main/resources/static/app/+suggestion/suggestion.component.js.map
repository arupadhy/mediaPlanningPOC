{"version":3,"file":"suggestion.component.js","sourceRoot":"","sources":["../../src/app/+suggestion/suggestion.component.ts"],"names":[],"mappings":"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","sourcesContent":["import { Component, OnInit, ElementRef} from '@angular/core';\r\nimport {Location} from '@angular/common';\r\nimport {CycquestionService} from '../shared/cycquestion.service';\r\nimport {RouteSegment, Router} from '@angular/router';\r\nimport {Question} from './question.model';\r\nimport {CycquestionComponent} from '../cycquestion/cycquestion.component';\r\nimport {QuerybuilderComponent} from '../querybuilder/querybuilder.component';\r\nimport {ReachdataService} from '../shared/reachdata.service';\r\nimport {MrifieldService} from '../shared/mrifield.service';\r\nimport {AudienceinsightService} from '../shared/audienceinsight.service';\r\nimport * as _ from 'lodash';\r\ndeclare var $: any;\r\ndeclare var Spinner: any;\r\n\r\n\r\n@Component({\r\n  moduleId: module.id,\r\n  selector: 'app-suggestion',\r\n  templateUrl: 'suggestion.component.html',\r\n  styleUrls: ['suggestion.component.css'],\r\n  providers: [CycquestionService, ReachdataService, MrifieldService, AudienceinsightService],\r\n  directives: [CycquestionComponent, QuerybuilderComponent]\r\n})\r\nexport class SuggestionComponent implements OnInit {\r\n\r\n  private questions: Question[];\r\n  private color: any = {};\r\n  selectedQuestion: Question;\r\n  mappedArray = [];\r\n  defaultQueryCondition: boolean = true;\r\n  private reachData: any;\r\n  private sessionId: string;\r\n  private selectedInputs: any;\r\n  private queryConstructedSoFar: string;\r\n  private fieldSelected: boolean = false;\r\n  private allSelectedFields: any = [];\r\n  private mriFields: Question[] = [];\r\n  private mriQueryInProgress: boolean = false;\r\n  private audienceInsights: any;\r\n  private contrastingFacts:any[];\r\n  private interestingFacts:any[];\r\n  private interestingValues:any[];\r\n  private audienceInsightQueryInProgress: boolean = false;\r\n  private editAudienceEnabled: boolean = false;\r\n  private recommendedFields: any[] = [];\r\n  private questionsUsedInQuery:Question[]=[];\r\n \r\n\r\n  public fireNewQuery(x) {\r\n    this.questionsUsedInQuery = x.questions;\r\n    this.queryConstructedSoFar = x.query;\r\n    this._reachService.getReachData(x.query)\r\n      .subscribe(\r\n      data => {\r\n        this.reachData = data;\r\n      });\r\n  }\r\n\r\n  public editTargetAudience(evt) {\r\n    if (evt.which == 13) {\r\n      this.editAudienceEnabled = false;\r\n      this._router.navigate(['concepts', { target: this.selectedInputs }]);\r\n    }\r\n  }\r\n\r\n  public enableEdit() {\r\n    this.editAudienceEnabled = true;\r\n  }\r\n\r\n  constructor(private _location:Location,private _router: Router, private _audienceService: AudienceinsightService, private _mriFieldService: MrifieldService, private _cycQuestionService: CycquestionService, private _routeSeg: RouteSegment, private _reachService: ReachdataService) {\r\n    this.color.questions = 'grey';\r\n    this.color.query = 'white';\r\n  }\r\n\r\n  public updateQuery(query) {\r\n    this.mappedArray['queryString'] = query || this.mappedArray['queryString'];\r\n    console.log(this.mappedArray);\r\n  }\r\n\r\n  ngOnInit() {\r\n    let audience:string = window.localStorage.getItem('audience');\r\n    let product:string = window.localStorage.getItem('product');\r\n    let campaign:string = window.localStorage.getItem('campaign');\r\n    this.selectedInputs = {audience:audience,product:product,campaign:campaign};\r\n    let q: any = JSON.parse(window.localStorage.getItem('target'));\r\n    this.sessionId = window.localStorage.getItem('session');\r\n    this.questions = this._cycQuestionService.loadQuestionsFromCyc(q,this.sessionId);\r\n  }\r\n\r\n  public loadMriFields() {\r\n    this.mriQueryInProgress = true;\r\n    this._location._subject.emit({ exportData: true });\r\n    this._mriFieldService.getHardCodedFields().split(';').forEach(\r\n      x => this.recommendedFields.push({value:x})\r\n    );\r\n\r\n    this.mriFields = this._mriFieldService.getMriFields(this.questionsUsedInQuery);\r\n  }\r\n\r\n  public loadInsight() {\r\n    console.log(\"loading insight\");\r\n    this.audienceInsightQueryInProgress = true;\r\n    var elem = document.getElementById('spinner');\r\n    var spinner = new Spinner({ radius: 60, width: 20, length: 80, lines: 15, className: 'loader', color: 'wheat' }).spin(elem);\r\n    this._audienceService.getAudienceInsights()\r\n      .subscribe(\r\n      data => {\r\n        this.audienceInsights = data.audienceInsights;\r\n        this.contrastingFacts = this.audienceInsights.CONTRASTING_FACTS;\r\n        this.interestingFacts = this.audienceInsights.INTERESTING_FACTS;\r\n        this.interestingValues = this.audienceInsights.INTERESTING_VALUES;\r\n        spinner.stop();\r\n      }\r\n      );;\r\n  }\r\n\r\n  public selectField(field) {\r\n    console.log(field);\r\n    console.log(field.fieldSelected);\r\n    field.fieldSelected = !field.fieldSelected;\r\n    console.log(field);\r\n    console.log(field.fieldSelected);\r\n    if (field.fieldSelected == true) {\r\n      console.log('true');\r\n      this.allSelectedFields.push(field);\r\n      //concept.selected = true;\r\n    }\r\n    else if (field.fieldSelected == false) {\r\n      console.log('false');\r\n       var index = this.allSelectedFields.indexOf(field);\r\n      this.allSelectedFields.splice(index, 1);\r\n    }\r\n  }\r\n\r\n  public selectAnswer(answer: any) {\r\n    answer.recommended = !answer.recommended;\r\n  }\r\n\r\n  public selectQuestion(q: any) {\r\n    q.selected = !q.selected;\r\n  }\r\n  \r\n  public showOutputs() {\r\n    this._router.navigate(['output']);\r\n  }\r\n\r\n}\r\n"]}