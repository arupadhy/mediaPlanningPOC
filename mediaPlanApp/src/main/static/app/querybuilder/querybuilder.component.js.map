{"version":3,"file":"querybuilder.component.js","sourceRoot":"","sources":["../../src/app/querybuilder/querybuilder.component.ts"],"names":[],"mappings":";;;;;;;;;;AAAA,qBAAmE,eAAe,CAAC,CAAA;AAEnF,kCAA+B,6BAA6B,CAAC,CAAA;AAU7D;IAwHE,+BAAY,OAAmB,EAAU,iBAAmC;QAAnC,sBAAiB,GAAjB,iBAAiB,CAAkB;QArHpE,sBAAiB,GAAU,EAAE,CAAC;QAG9B,cAAS,GAAa,EAAE,CAAC;QAEzB,yBAAoB,GAAe,EAAE,CAAC;QAGtC,UAAK,GAAsB,IAAI,mBAAY,EAAO,CAAC;QA8GzD,IAAI,CAAC,IAAI,GAAG,OAAO,CAAC;QACpB,OAAO,CAAC,GAAG,CAAC,uCAAuC,CAAC,CAAC;QACrD,2BAA2B;IAE7B,CAAC;IA/GM,oCAAI,GAAX,UAAY,CAAC;QACX,CAAC,CAAC,cAAc,EAAE,CAAC;IACrB,CAAC;IAED,2CAAW,GAAX,UAAY,IAAS;QACnB,IAAI,KAAK,GAAW,GAAG,CAAC;QACxB,KAAK,GAAG,KAAK,CAAC,MAAM,CAAC,IAAI,CAAC,EAAE,CAAC,CAAC;QAC9B,IAAI,OAAO,GAAa,EAAE,CAAC;QAC3B,IAAI,CAAC,OAAO,CAAC,OAAO,CAClB,UAAA,CAAC;YACC,EAAE,CAAC,CAAC,CAAC,CAAC,WAAW,CAAC,CAAC,CAAC;gBAClB,OAAO,CAAC,IAAI,CAAC,CAAC,CAAC,EAAE,CAAC,CAAC;YACrB,CAAC;QACH,CAAC,CACF,CAAC;QACF,KAAK,GAAG,KAAK,CAAC,MAAM,CAAC,GAAG,CAAC,CAAC,MAAM,CAAC,OAAO,CAAC,QAAQ,EAAE,CAAC,CAAC;QACrD,MAAM,CAAC,KAAK,CAAC,MAAM,CAAC,GAAG,CAAC,CAAC;IAE3B,CAAC;IAEM,oCAAI,GAAX,UAAY,CAAC;QACX,IAAI,GAAG,GAAG,IAAI,CAAC;QACf,CAAC,CAAC,cAAc,EAAE,CAAC;QACnB,IAAI,IAAI,GAAG,CAAC,CAAC,YAAY,CAAC,OAAO,CAAC,QAAQ,CAAC,CAAC;QAC5C,IAAI,KAAK,GAAG,CAAC,CAAC,YAAY,CAAC,OAAO,CAAC,OAAO,CAAC,CAAC;QAC5C,EAAE,CAAC,CAAC,CAAC,IAAI,CAAC,WAAW,CAAC,CAAC,CAAC;YACtB,OAAO,CAAC,GAAG,CAAC,kCAAkC,CAAC,CAAC;YAChD,IAAI,CAAC,WAAW,GAAG,IAAI,CAAC,WAAW,CAAC,IAAI,CAAC,KAAK,CAAC,IAAI,CAAC,CAAC,CAAC;YACtD,IAAI,CAAC,cAAc,CAAC,IAAI,CAAC,WAAW,CAAC,CAAC;YACtC,IAAI,CAAC,KAAK,CAAC,IAAI,CAAC,IAAI,CAAC,WAAW,CAAC,CAAC;QACpC,CAAC;QACD,IAAI,CAAC,oBAAoB,CAAC,IAAI,CAAC,IAAI,CAAC,KAAK,CAAC,IAAI,CAAC,CAAC,CAAC;QAEjD,wBAAwB;QACxB,0BAA0B;QAE1B,EAAE,CAAC,CAAC,IAAI,CAAC,CAAC,CAAC,CAAC,CAAC;YACX,iDAAiD;YACjD,OAAO,CAAC,GAAG,CAAC,IAAI,CAAC,iBAAiB,CAAC,CAAC;YACpC,EAAE,CAAC,CAAC,CAAC,KAAK,CAAC,CAAC,CAAC,CAAC;gBACZ,KAAK,CAAC,+CAA+C,CAAC,CAAC;YACzD,CAAC;YAAC,IAAI,CAAC,CAAC;gBAEN,CAAC,CAAC,eAAe,CAAC,CAAC,MAAM,CAAC;oBACxB,IAAI,EAAE;wBACJ,MAAM,EAAE,OAAO;wBACf,QAAQ,EAAE,IAAI;qBACf;oBACD,IAAI,EAAE;wBACJ,MAAM,EAAE,SAAS;wBACjB,QAAQ,EAAE,IAAI;qBACf;oBACD,KAAK,EAAE,IAAI;oBACX,KAAK,EAAE,GAAG;oBACV,OAAO,EAAE;wBACP,KAAK,EAAE;4BACL,GAAG,CAAC,iBAAiB,CAAC,IAAI,CAAC,EAAE,OAAO,EAAE,KAAK,EAAE,CAAC,CAAC;4BAC/C,GAAG,CAAC,iBAAiB,CAAC,IAAI,CAAC,EAAE,KAAK,EAAE,GAAG,GAAG,KAAK,EAAE,CAAC,CAAC;4BACnD,GAAG,CAAC,iBAAiB,CAAC,IAAI,CAAC,EAAE,QAAQ,EAAC,GAAG,CAAC,wBAAwB,CAAC,IAAI,CAAC,KAAK,CAAC,IAAI,CAAC,CAAC,EAAC,CAAC,CAAC;4BACvF,GAAG,CAAC,SAAS,CAAC,IAAI,CAAC,GAAG,GAAG,KAAK,CAAC,CAAC;4BAChC,GAAG,CAAC,KAAK,CAAC,IAAI,CAAC,IAAI,CAAC,CAAC;4BACrB,GAAG,CAAC,WAAW,GAAG,GAAG,CAAC,WAAW,CAAC,MAAM,CAAC,KAAK,CAAC,CAAC,MAAM,CAAC,GAAG,CAAC,WAAW,CAAC,IAAI,CAAC,KAAK,CAAC,IAAI,CAAC,CAAC,CAAC,CAAC;4BAC1F,GAAG,CAAC,cAAc,CAAC,GAAG,CAAC,WAAW,CAAC,CAAC;4BACpC,GAAG,CAAC,KAAK,CAAC,IAAI,CAAC,GAAG,CAAC,WAAW,CAAC,CAAC;4BAChC,CAAC,CAAC,IAAI,CAAC,CAAC,MAAM,CAAC,OAAO,CAAC,CAAC;wBAC1B,CAAC;wBACD,IAAI,EAAE;4BACJ,GAAG,CAAC,iBAAiB,CAAC,IAAI,CAAC,EAAE,OAAO,EAAE,IAAI,EAAE,CAAC,CAAC;4BAC9C,GAAG,CAAC,iBAAiB,CAAC,IAAI,CAAC,EAAE,KAAK,EAAE,GAAG,GAAG,KAAK,EAAE,CAAC,CAAC;4BACnD,GAAG,CAAC,iBAAiB,CAAC,IAAI,CAAC,EAAE,QAAQ,EAAC,GAAG,CAAC,wBAAwB,CAAC,IAAI,CAAC,KAAK,CAAC,IAAI,CAAC,CAAC,EAAC,CAAC,CAAC;4BACvF,GAAG,CAAC,SAAS,CAAC,IAAI,CAAC,GAAG,GAAG,KAAK,CAAC,CAAC;4BAChC,GAAG,CAAC,KAAK,CAAC,IAAI,CAAC,IAAI,CAAC,CAAC;4BACrB,GAAG,CAAC,WAAW,GAAG,GAAG,CAAC,WAAW,CAAC,MAAM,CAAC,IAAI,CAAC,CAAC,MAAM,CAAC,GAAG,CAAC,WAAW,CAAC,IAAI,CAAC,KAAK,CAAC,IAAI,CAAC,CAAC,CAAC,CAAC;4BACzF,GAAG,CAAC,cAAc,CAAC,GAAG,CAAC,WAAW,CAAC,CAAC;4BACpC,GAAG,CAAC,KAAK,CAAC,IAAI,CAAC,GAAG,CAAC,WAAW,CAAC,CAAC;4BAChC,CAAC,CAAC,IAAI,CAAC,CAAC,MAAM,CAAC,OAAO,CAAC,CAAC;wBAC1B,CAAC;qBACF;iBACF,CAAC,CAAC;YACL,CAAC;QAEH,CAAC;QAAC,IAAI,CAAC,CAAC;YACN,IAAI,CAAC,CAAC,GAAG,GAAG,GAAG,KAAK,CAAC;YACrB,IAAI,CAAC,iBAAiB,CAAC,IAAI,CAAC,EAAE,KAAK,EAAE,IAAI,CAAC,CAAC,EAAE,CAAC,CAAC;YACvC,GAAG,CAAC,iBAAiB,CAAC,IAAI,CAAC,EAAE,QAAQ,EAAC,GAAG,CAAC,wBAAwB,CAAC,IAAI,CAAC,KAAK,CAAC,IAAI,CAAC,CAAC,EAAC,CAAC,CAAC;YAC/F,GAAG,CAAC,SAAS,CAAC,IAAI,CAAC,GAAG,GAAG,KAAK,CAAC,CAAC;QAClC,CAAC;IACH,CAAC;IAEM,wDAAwB,GAA/B,UAAgC,CAAK;QACnC,IAAI,eAAe,GAAU,EAAE,CAAC;QAChC,eAAe,GAAG,eAAe,CAAC,MAAM,CAAC,CAAC,CAAC,EAAE,CAAC,CAAC,MAAM,CAAC,IAAI,CAAC,CAAC;QAC5D,IAAI,cAAc,GAAU,EAAE,CAAC;QAC/B,CAAC,CAAC,OAAO,CAAC,OAAO,CACf,UAAA,CAAC;YAAM,EAAE,CAAA,CAAC,CAAC,CAAC,WAAW,CAAC,CAAC,CAAC;gBAAA,cAAc,GAAG,cAAc,CAAC,MAAM,CAAC,CAAC,CAAC,EAAE,CAAC,CAAC,MAAM,CAAC,GAAG,CAAC,CAAA;YAAA,CAAC;QACnF,CAAC,CACF,CAAA;QACA,MAAM,CAAC,eAAe,CAAC,MAAM,CAAC,cAAc,CAAC,CAAC;IACjD,CAAC;IAED,wCAAQ,GAAR;QACE,IAAI,CAAC,GAAW,EAAE,CAAC;QACnB,IAAI,CAAC,iBAAiB,CAAC,OAAO,CAAC,UAAA,CAAC,IAAI,OAAA,CAAC,GAAG,CAAC,GAAG,KAAK,EAAb,CAAa,CAAC,CAAC;QACnD,MAAM,CAAC,CAAC,CAAC;IACX,CAAC;IASM,gDAAgB,GAAvB,UAAwB,CAAC;QACvB,IAAI,IAAI,GAAG,CAAC,CAAC,YAAY,CAAC,OAAO,CAAC,QAAQ,CAAC,CAAC;QAC5C,IAAI,KAAK,GAAG,CAAC,CAAC,YAAY,CAAC,OAAO,CAAC,OAAO,CAAC,CAAC;QAC5C,IAAI,WAAW,GAAG,IAAI,CAAC,WAAW,CAAC,IAAI,CAAC,KAAK,CAAC,IAAI,CAAC,CAAC,CAAC;QACrD,IAAI,CAAC,cAAc,CAAC,WAAW,CAAC,CAAC;IACnC,CAAC;IAEM,8CAAc,GAArB,UAAsB,GAAW;QAAjC,iBASC;QARC,IAAI,CAAC,iBAAiB,CAAC,YAAY,CAAC,GAAG,CAAC;aACrC,SAAS,CACV,UAAA,IAAI;YAEF,KAAI,CAAC,SAAS,GAAG,IAAI,CAAC;YACtB,KAAI,CAAC,SAAS,CAAC,KAAK,GAAG,GAAG,CAAC;QAC7B,CAAC,CACA,CAAA;IACL,CAAC;IAGD,wCAAQ,GAAR;IACA,CAAC;IAzID;QAAC,aAAM,EAAE;;wDAAA;IAjBX;QAAC,gBAAS,CAAC;YACT,QAAQ,EAAE,MAAM,CAAC,EAAE;YACnB,QAAQ,EAAE,eAAe;YACzB,WAAW,EAAE,6BAA6B;YAC1C,SAAS,EAAE,CAAC,4BAA4B,CAAC;YACzC,SAAS,EAAE,CAAC,oCAAgB,CAAC;SAC9B,CAAC;;6BAAA;IAsJF,4BAAC;AAAD,CAAC,AArJD,IAqJC;AArJY,6BAAqB,wBAqJjC,CAAA","sourcesContent":["import { Component, OnInit, ElementRef, Output, EventEmitter} from '@angular/core';\r\nimport {Question} from '../+suggestion/question.model';\r\nimport {ReachdataService} from '../shared/reachdata.service';\r\ndeclare var $: any;\r\n\r\n@Component({\r\n  moduleId: module.id,\r\n  selector: 'query-builder',\r\n  templateUrl: 'querybuilder.component.html',\r\n  styleUrls: ['querybuilder.component.css'],\r\n  providers: [ReachdataService]\r\n})\r\nexport class QuerybuilderComponent implements OnInit {\r\n\r\n  private elem: ElementRef;\r\n  private existingQuestions: any[] = [];\r\n  private q: string;\r\n  private queryString: string;\r\n  private questions: string[] = [];\r\n  private reachData: any;\r\n  private questionsUsedInQuery: Question[] = [];\r\n\r\n  @Output()\r\n  private query: EventEmitter<any> = new EventEmitter<any>();\r\n\r\n\r\n  public test(e) {\r\n    e.preventDefault();\r\n  }\r\n\r\n  createQuery(data: any): string {\r\n    let query: string = \"(\";\r\n    query = query.concat(data.nl);\r\n    let answers: string[] = [];\r\n    data.answers.forEach(\r\n      a => {\r\n        if (a.recommended) {\r\n          answers.push(a.nl);\r\n        }\r\n      }\r\n    );\r\n    query = query.concat(\":\").concat(answers.toString());\r\n    return query.concat(\")\");\r\n\r\n  }\r\n\r\n  public drop(e) {\r\n    var ref = this;\r\n    e.preventDefault();\r\n    var data = e.dataTransfer.getData('custom');\r\n    var index = e.dataTransfer.getData('index');\r\n    if (!this.queryString) {\r\n      console.log(\"querystring hasn't been init yet\");\r\n      this.queryString = this.createQuery(JSON.parse(data));\r\n      this.fetchReachData(this.queryString);\r\n      this.query.emit(this.queryString);\r\n    }\r\n    this.questionsUsedInQuery.push(JSON.parse(data));\r\n\r\n    // console.log(data.nl);\r\n    // console.log(data.cycl);\r\n\r\n    if (this.q) {\r\n      //check if this question has already been dropped\r\n      console.log(this.existingQuestions);\r\n      if (1 === 2) {\r\n        alert(\"This question is already present in the query\");\r\n      } else {\r\n\r\n        $('#and-or-query').dialog({\r\n          show: {\r\n            effect: \"blind\",\r\n            duration: 1000\r\n          },\r\n          hide: {\r\n            effect: \"explode\",\r\n            duration: 1000\r\n          },\r\n          modal: true,\r\n          width: 400,\r\n          buttons: {\r\n            \"AND\": function () {\r\n              ref.existingQuestions.push({ operand: \"and\" });\r\n              ref.existingQuestions.push({ value: \"Q\" + index });\r\n              ref.existingQuestions.push({ question:ref.getDroppedQuestionString(JSON.parse(data))});\r\n              ref.questions.push(\"Q\" + index);\r\n              ref.query.emit(data);\r\n              ref.queryString = ref.queryString.concat(\"AND\").concat(ref.createQuery(JSON.parse(data)));\r\n              ref.fetchReachData(ref.queryString);\r\n              ref.query.emit(ref.queryString);\r\n              $(this).dialog(\"close\");\r\n            },\r\n            \"OR\": function () {\r\n              ref.existingQuestions.push({ operand: \"or\" });\r\n              ref.existingQuestions.push({ value: \"Q\" + index });\r\n              ref.existingQuestions.push({ question:ref.getDroppedQuestionString(JSON.parse(data))});\r\n              ref.questions.push(\"Q\" + index);\r\n              ref.query.emit(data);\r\n              ref.queryString = ref.queryString.concat(\"OR\").concat(ref.createQuery(JSON.parse(data)));\r\n              ref.fetchReachData(ref.queryString);\r\n              ref.query.emit(ref.queryString);\r\n              $(this).dialog(\"close\");\r\n            }\r\n          }\r\n        });\r\n      }\r\n\r\n    } else {\r\n      this.q = \"Q\" + index;\r\n      this.existingQuestions.push({ value: this.q });\r\n              ref.existingQuestions.push({ question:ref.getDroppedQuestionString(JSON.parse(data))});\r\n      ref.questions.push(\"Q\" + index);\r\n    }\r\n  }\r\n  \r\n  public getDroppedQuestionString(q:any) {\r\n    let droppedQuestion:string = \"\";\r\n    droppedQuestion = droppedQuestion.concat(q.nl).concat(\": \");\r\n    let droppedAnswers:string = \"\";\r\n    q.answers.forEach(\r\n      a => { if(a.recommended) {droppedAnswers = droppedAnswers.concat(a.nl).concat(\",\")}\r\n      }\r\n    )\r\n     return droppedQuestion.concat(droppedAnswers);\r\n  }\r\n\r\n  getQuery() {\r\n    let s: string = '';\r\n    this.existingQuestions.forEach(a => s = s + 'and');\r\n    return s;\r\n  }\r\n\r\n  constructor(element: ElementRef, private _reachDataService: ReachdataService) {\r\n    this.elem = element;\r\n    console.log('consructor for querybuilder component');\r\n    //$(\"#yyy\").queryBuilder();\r\n\r\n  }\r\n\r\n  public droppedSomething(e) {\r\n    var data = e.dataTransfer.getData('custom');\r\n    var index = e.dataTransfer.getData('index');\r\n    var queryString = this.createQuery(JSON.parse(data));\r\n    this.fetchReachData(queryString);\r\n  }\r\n\r\n  public fetchReachData(str: string) {\r\n    this._reachDataService.getReachData(str)\r\n      .subscribe(\r\n      data => {\r\n\r\n        this.reachData = data;\r\n        this.reachData.query = str;\r\n      }\r\n      )\r\n  }\r\n\r\n\r\n  ngOnInit() {\r\n  }\r\n\r\n}"]}